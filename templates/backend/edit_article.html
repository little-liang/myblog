<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/custom.css" rel="stylesheet">
    <link href="/static/plugins/kindeditor/themes/default/default.css" rel="stylesheet">

</head>

<body>

{#<!--大标题-->#}
<div class="page-header-for-admin">
    <h1 class="text-center">Hello Blog</h1>
</div>

<!--左侧栏-->
<div class="col-lg-2">
    <div class="list-group text-for-admin">
        <ul class="left-content-for-admin" id="drop1">
            <li>
                <a href="#" class="list-group-item active" id="dropdown1">文章管理<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span><span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span></a>
                <ul class="left-content-for-admin" >
                    <li><a href="#" class="list-group-item">文章管理</a></li>
                    <li><a href="#" class="list-group-item">文章管理</a></li>
                    <li><a href="#" class="list-group-item">文章管理</a></li>
                </ul>
            </li>
        </ul>
    </div>
</div>

<!--编辑文章-->
<div class="col-lg-9-for-admin">

    {% csrf_token %}
    <form class="form-horizontal" action="edit_article.html">

        <div class="form-group">
            <label class="col-sm-2 control-label">标题:</label>
            <input class="form-control" id="article_id" style="width: 70%;"  name="title" type="text" placeholder="请输入标题">
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">分类:</label>

        <select id="catatory" class="btn btn-default">

            {% if current_catagory_info %}
                <option class="btn btn-default">{{ current_catagory_info }}</option>
            {% endif %}


            {% for line in all_catagory_info_list %}
                {% if line != current_catagory_info %}
                    <option class="btn btn-default">{{ line }}</option>
                {% endif %}

            {% endfor %}
        </select>


        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">摘要:</label>
            <textarea id="summary" class="form-control" rows="4" style="width: 70%"></textarea>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">正文:</label>
            <textarea id="editor_id" name="content" style="width:70%;height:400px;visibility:hidden;"></textarea>
        </div>

        <div style="margin-left: 5%">
            <input type="radio" name="optionsRadiosinline" id="optionsRadios3" value="option1" checked>允许评论
            &nbsp;
            <input type="radio" name="optionsRadiosinline" id="optionsRadios4"  value="option2">不允许评论
        </div>


        <div style="margin-left: 5%">
            <br />
            <button class="btn btn-info" name="submit" type="button">保存</button>
            <button class="btn btn-danger" type="button">退出</button>
        </div>
        </form>
    </div>


</body>
<script src="/static/js/custom.js"></script>
<script src="/static/js/jquery-3.2.1.js"></script>
<script src="/static/js/bootstrap.min.js"></script>

<script src="/static/plugins/kindeditor/kindeditor-all.js"></script>
<script>
    var editor;
    KindEditor.ready(function(K) {
        editor = K.create('textarea[name="content"]', {
            allowFileManager : true,
            filterMode : false,
            wellformatmode : false
        });


        editor.html('{{ article_info.content|safe }}');

    });

    $(document).ready(function () {
        //如果有后台发过来的文章详情,没有就是新加文章

        if ('{{ article_info }}' != ''){
            $("[name='title']").val('{{ article_info.title|safe }}');
            $("#summary").val("{{ article_info.summary }}");
        }



        $(document).on('click','[name="submit"]',function () {
            var data = {};
            if ('{{ article_info }}' != ''){
                data['id'] = '{{ article_info.id }}';
            }
            data['catagory_post'] = $("#catatory").val();
            data['content_post'] = editor.html().replace(/(\n)/g, "");
            data['summary_post'] = $("#summary").val();
            data['title_post'] = $("[name='title']").val();



            $.ajax({
                url:'{% url 'edit_article' %}',
                type:'POST', //GET
                async:true,    //或false,是否异步
                data:data,
                timeout:5000,    //超时时间
                dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
                beforeSend:function(data){
                    console.log('发送前');
                    console.log(data);
                },
                success:function(data){
                    console.log('成功');
                    console.log(data);
                    alert('保存成功!');
                    window.location.href="{% url 'article_admin' %}";

                },
                error:function(data){
                    console.log('错误');
                    console.log(data);

                },
                complete:function(data){
                    console.log('结束');
                    console.log(data);
                }
            })



        });

    });



</script>

</html>